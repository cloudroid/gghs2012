% Latex source for:
%   "Rapid 3D inversion of gravity and gravity gradient data to test geologic
%    hypotheses" by Leonardo Uieda and Valeria C F Barbosa

\RequirePackage{fix-cm}
\documentclass[twocolumn,final]{svjour3}
%\documentclass[twocolumn,draft]{svjour3}
%\documentclass[twocolumn,referee]{svjour3}

\smartqed  % flush right qed marks, e.g. at end of proof

\usepackage{graphicx}
\usepackage{amsmath}
\usepackage[round,sort]{natbib}

% Custom commands
\newcommand{\vect}[1]{\mathbf{#1}}
\newcommand{\mat}[1]{\mathbf{#1}}

\journalname{International Association of Geodesy Symposia}

\begin{document}

% TITLE AND AUTHORS
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\title{
    Rapid 3D inversion
    of gravity data
    to test geologic hypotheses
}
\author{Leonardo Uieda \and Val\'eria C. F. Barbosa}

%\titlerunning{Short form of title}        % if too long for running head
%\authorrunning{Short form of author list} % if too long for running head

\institute{
    L. Uieda \and V.C.F. Barbosa \at
        Observat\'orio Nacional,
        Rua General Jos\'e Cristino 77,
        20921-400 Rio de Janeiro - RJ, Brazil.
        \email{leouieda@gmail.com; valcris@on.br}
}

\date{Received:  / Accepted: }

\maketitle

% ABSTRACT AND KEYWORDS
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\begin{abstract}
% Note: Max 250 words
Meh


\keywords{
    Gravity inversion \and
    Gravity gradiometry \and
    Modeling \and
    3D \and
    GOCE
}
\end{abstract}

% INTRODUCTION
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\section{Introduction}

\begin{sloppypar}
Forward modeling of potential fields
is a useful way to generate geophysical models
that incorporate the interpreter's knowledge
about the regional and local geology.
However,
when modeling in 3D
and/or trying to fit multiple data components
(e.g., in gravity gradiometry),
forward modeling can be a tedious task.
That is because the interpreter is
tasked with simultaneously
constructing geologically realistic models
and supervising the data fit.
\\\indent
These problems are partially solved
by methods of geophysical inversion,
which automatically fit the data.
Conversely,
inverse problems introduce other challenges of their own.
Most geophysical inverse problems are ill-posed
because their solutions are neither unique nor stable.
Thus, they require the introduction of prior information,
usually through regularization \citep{silva_potinversion}.
Moreover, 3D inverse problems are computationally expensive.
\\\indent
Recent developments in potential field inversion
have proposed different types of regularization
to transform the ill-posed problem into a well-posed one
\citep[e.g.,][]{last_kubik, li_oldenburg, zhdanov_focusing, silva_interactive,
silvadias_adaptive, martins_tv}.
In addition,
several techniques have been applied
to overcome the computational complexity,
like data compression \citep{zhdanov_compression, li_compression},
lazy evaluation of the sensitivity matrix \citep{uieda_planting},
moving footprint \citep{cox_footprint},
and parallel computation \citep{cuma_largescale}.
\\\indent
We call attention
to the method called ``planting anomalous densities''
of \citet{uieda_planting}
that has been further developed by \citet{uieda_shape}.
This method is based on
the work of \citet{rene}.
It uses an iterative algorithm
to automatically grow the anomalous bodies
around user-specified prismatic elements called ``seeds'',
which have fixed density contrasts and positions.
Thus, the seeds provide
a skeletal outline of the presumed geologic bodies.
The inversion algorithm concentrates mass
around this ``skeleton''
in a way that both
fits the observed data
and yields compact bodies.
Therefore,
these seeds provide
a way for the interpreter
to impose prior geologic and geophysical information
on the inversion.
The interpreter needs only to supply the seeds
that specify the body's skeleton,
eliminating the exhaustive task
of specifying the complete geometry
of multiple bodies.
Moreover,
the interpreter is liberated
from the time-consuming procedure
of yielding a reasonable fit to the data.
This allows the use
of more than one type of data
without any added effort.
\\\indent
The computational efficiency
of the method of planting anomalous densities
allows it be used to quickly test geologic hypothesis
of different locations and density contrasts
for presumed sources.
We illustrate this hypothesis testing procedure
with an application
to the Registro do Araguaia gravity anomaly, Brazil.
\end{sloppypar}

% METHODOLOGY
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\section{Methodology}

\begin{sloppypar}

The method of planting anomalous densities \citep{uieda_planting}
solves the inverse problem
of estimating an anomalous density distribution
(geologic bodies)
from observed data.
It constructs a solution
using an iterative algorithm.




Let us assume that there are $N_{c}$ types of observations available (e.g.,
the gravitational attraction and/or some combination of the components of the
gravity gradient tensor).
Now, let $\vect{g}^{\thinspace k}$, $k=1,\ldots,N_{c}$, be a vector with
$L$ observations of one of these types of data.
We assume that $\vect{g}^{\thinspace k}$ is caused by an anomalous density
distribution in the subsurface.
We discretize the subsurface into an interpretative model consisting of $M$
juxtaposed right rectangular prisms with homogeneous densities.
It follows that $\vect{g}^{\thinspace k}$ can be approximated by the sum of the
contribution of each prism.
In matrix notation, this relation is given by

\begin{equation}
    \vect{d}^{\thinspace k} = \mat{A}^{k}~\vect{p},
    \label{eq:forward}
\end{equation}

where $\vect{d}^{\thinspace k}$, $k=1,\ldots,N_{c}$, is the $L$-dimensional
predicted data vector,
$\vect{p}$ is the $M$-dimensional parameter vector whose $j$th element is the
density of the $j$th prism, and $\mat{A}^{k}$, $k=1,\ldots,N_{c}$, is the
$L \times M$ sensitivity matrix.
The elements of the sensitivity matrix can be calculated using the formula of
%\citet{Nagy2000}.
\\[0.2cm]
The misfit between $\vect{g}^{\thinspace k}$ and $\vect{d}^{\thinspace k}$ can
be expressed through the normalized $\ell_{2}$-norm data-misfit function

\begin{equation}
    \phi^{k}(\vect{p}) = \sqrt{
    \dfrac{
        \sum\limits_{i=1}^{L}
        \left( g_{i}^{\thinspace k} - d_{i}^{\thinspace k} \right)^{2}
    }{
        \sum\limits_{i=1}^{L}\left(g_{i}^{\thinspace k}\right)^{2}}}.
    \label{eq:phik}
\end{equation}

Another measure of this misfit is the ``shape-of-anomaly'' function of
\citet{rene}

\begin{equation}
    \psi^{\thinspace k}(\vect{p}) = \sqrt{
        \sum\limits_{i=1}^{L}
        \left(\alpha^{\thinspace k} g_{i}^{\thinspace k} - d_{i}^{\thinspace k}
        \right)^{2}
    },
    \label{eq:shapek}
\end{equation}

where $\alpha^{\thinspace k}$, $k=1,\ldots,N_{c}$, is a scale factor.
The shape-of-anomaly function, as its name suggests, measures only the
difference in shape between the observed and predicted data.
If the two data have the same shape, they will differ only by a factor of
$\alpha^{\thinspace k}$.
Thus, the optimum value for $\alpha^{\thinspace k}$ is the one that minimizes
$\psi^{\thinspace k}$ (equation \ref{eq:shapek}) \citep{rene}.
For a given predicted data vector $\vect{d}^{\thinspace k}$
(equation \ref{eq:forward}), the value of
$\alpha^{\thinspace k}$ is calculated by differentiating $\psi^{\thinspace k}$
with respect to $\alpha^{\thinspace k}$ and equating the result to zero,
i.e.,

\begin{equation}
    \dfrac{\partial \psi^{\thinspace k}}{\partial \alpha^{\thinspace k}} =
    \dfrac{\alpha^{\thinspace k}
        \sum\limits_{i=1}^{L}\left(g_{i}^{\thinspace k}\right)^{2} +
        \sum\limits_{i=1}^{L} g_{i}^{\thinspace k}d_{i}^{\thinspace k}}
        {\sqrt{\sum\limits_{i=1}^{L}
        \left(\alpha^{\thinspace k} g_{i}^{\thinspace k} - d_{i}^{\thinspace k}
        \right)^{2}}} = 0~.
\end{equation}

Hence, before evaluating function $\psi^{\thinspace k}$ (equation
\ref{eq:shapek}), $\alpha^{\thinspace k}$ can be calculated by \citep{rene}

\begin{equation}
    \alpha^{\thinspace k} = \dfrac{
        \sum\limits_{i=1}^{L} g_{i}^{\thinspace k} d_{i}^{\thinspace k}
    }{
        \sum\limits_{i=1}^{L}\left( g_{i}^{\thinspace k}\right)^{2}
    }.
    \label{eq:alpha}
\end{equation}

We can then define the total data-misfit function as the sum of the individual
data-misfit functions (equation \ref{eq:phik}) of each type of data available,
i.e.,

\begin{equation}
    \Phi(\vect{p}) = \sum\limits_{k=1}^{N_{c}} \phi^{k}(\vect{p}),
    \label{eq:phi}
\end{equation}

and, likewise, total shape-of-anomaly function as

\begin{equation}
    \Psi(\vect{p}) = \sum\limits_{k=1}^{N_{c}} \psi^{\thinspace k}(\vect{p}).
    \label{eq:shape}
\end{equation}

From now on, we follow the methodology of \citet{uieda_planting}, in which the
solution is iteratively built by the accretion of prisms to user-specified
``seeds''.
These seeds are prisms of the interpretative model with given density contrasts.
Before the iterative growth process starts, all elements of the parameter vector
$\vect{p}$ are set to zero.
Next, the elements of $\vect{p}$ corresponding to the seeds are assigned the
density contrasts of the respective seeds (Figure~\ref{fig:sketch}a).
The growth process is then started.
An iteration of the growth process consists of attempting to grow, one at a
time, each of the $N_{s}$ seeds (Figure~\ref{fig:sketch}b).
A seed grows by attempting to perform the accretion of one of its neighboring
prisms (i.e., prisms that share a face).
We define the accretion of a prism as changing its density contrast from zero to
the density contrast of the respective seed undergoing the accretion.
In order to be chosen for accretion, a neighboring prism must satisfy two
criteria:

\begin{enumerate}
    \item The accretion of a prism must decrease the total data-misfit
    function $\Phi(\vect{p})$ (equation \ref{eq:phi}) and satisfy the condition
    \begin{equation}
        \dfrac{|\Phi_{(new)} - \Phi_{(old)}|}{\Phi_{(old)}} \ge \delta ,
        \label{eq:delta}
    \end{equation}
    where $\Phi_{(new)}$ is the value of $\Phi(\vect{p})$ evaluated with the
    prism included in the estimate, $\Phi_{(old)}$ is the previous value of
    $\Phi(\vect{p})$, and $\delta$ is a small positive constant that controls
    how much the solution is allowed to grow.

    \item The accretion of a prism must produce the smallest value of the goal
    function $\Gamma(\vect{p})$ out of all other prisms that satisfy the first
    criterion. Unlike \citet{uieda_planting}, we define the goal function as
    \begin{equation}
        \Gamma(\vect{p}) = \Psi(\vect{p}) + \mu\theta(\vect{p}),
        \label{eq:goal}
    \end{equation}
    where $\Psi(\vect{p})$ is the total shape-of-anomaly function (equation
    \ref{eq:shape}), $\mu$ is a regularizing parameter, and $\theta(\vect{p})$
    is a modified version of the regularizing function of \citet{uieda_planting}
    \begin{equation}
        \theta(\vect{p}) = \frac{1}{f} \sum\limits_{j=1}^{M}
        \dfrac{p_j}{p_j + \epsilon} l_{j},
        \label{eq:regul}
    \end{equation}
    where $p_{j}$, $j=1,\ldots,M$, is the $j$th element of parameter vector
    $\vect{p}$,
    $\epsilon$ is a small positive constant, $l_{j}$ is the distance between the
    $j$th prism and the seed which performed its accretion, and $f$ is a scaling
    factor equal to the mean extent of the interpretative model
    (the region in the subsurface to be interpreted).
    In practice, $\epsilon$ is not needed because one could simply sum $l_{j}$
    or zero when evaluating the regularizing function.
\end{enumerate}

If none of the neighboring prisms of a seed satisfy these criteria, the
seed does not grow during this iteration.
The growth process continues while at least one seed is able to grow
(Figure~\ref{fig:sketch}c).
\citet{uieda_animation} provide an animation of a growth process performed on
synthetic data using the method of \citet{uieda_planting}.
\\[0.2cm]
We emphasize that the full sensitivity matrices $\mat{A}^{k}$ are not needed
at any single time during the inversion process.
Therefore, the ``lazy evaluation'' of the sensitivity matrices
proposed in \citet{uieda_planting} is still possible
in our modified algorithm, making the inversion fast and memory efficient.
\\[0.2cm]
For clarity, the modified planting algorithm proposed here will be henceforth
referred to as the shape-of-anomaly planting algorithm.
\end{sloppypar}

\begin{figure}
    \includegraphics{fig/method}
    \caption{Please write your figure caption here}
    \label{fig:method}
\end{figure}

% APPLICATION
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\section{Example application}


% For one-column wide figures use
\begin{figure}
% Use the relevant command to insert your figure file.
% For example, with the graphicx package use
  %\includegraphics{example.eps}
% figure caption is below the figure
\caption{Please write your figure caption here}
\label{fig:1}       % Give a unique label
\end{figure}

% For two-column wide figures use
\begin{figure*}
% Use the relevant command to insert your figure file.
% For example, with the graphicx package use
  %\includegraphics[width=0.75\textwidth]{example.eps}
% figure caption is below the figure
\caption{Please write your figure caption here}
\label{fig:2}       % Give a unique label
\end{figure*}

% For tables use
\begin{table}
% table caption is above the table
\caption{Please write your table caption here}
\label{tab:1}       % Give a unique label
% For LaTeX tables use
\begin{tabular}{lll}
\hline\noalign{\smallskip}
first & second & third  \\
\noalign{\smallskip}\hline\noalign{\smallskip}
number & number & number \\
number & number & number \\
\noalign{\smallskip}\hline
\end{tabular}
\end{table}

% CONCLUSIONS
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\section{Conclusions}
\label{conclusions}

% ACKNOWLEDGEMENTS
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\begin{acknowledgements}
We acknowledge the use of software
matplotlib by \citet{matplotlib} and
Mayavi by \citet{mayavi}.
The authors were supported in this research by
a fellowship (VCFB) from CNPq
and a scholarship (LU) from CAPES, Brazil.
Additional support for the authors
was provided by the Brazilian agencies
CNPq (grant 471693/2011-1) and FAPERJ (grant E-26/103.175/2011).
\end{acknowledgements}


% REFERENCES
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\begin{thebibliography}{}

\bibitem[Cox et~al., 2010]{cox_footprint}
Cox LH, Wilson G a., Zhdanov MS (2010)
3D inversion of airborne electromagnetic data using a moving footprint.
Exploration Geophysics 41:250-259. doi: 10.1071/EG10003

\bibitem[\v{C}uma et~al., 2012]{cuma_largescale}
\v{C}uma M, Wilson G a., Zhdanov MS, Cuma M (2012)
Large-scale 3D inversion of potential field data. Geophysical Prospecting.
doi: 10.1111/j.1365-2478.2011.01052.x

\bibitem[Hunter, 2007]{matplotlib}
Hunter JD (2007)
Matplotlib: A 2D Graphics Environment. Computing in Science \& Engineering
9:90-95. doi: 10.1109/MCSE.2007.55

\bibitem[Last and Kubik, 1983]{last_kubik}
Last BJ, Kubik K (1983)
Compact gravity inversion. Geophysics 48:713-721. doi: 10.1190/1.1441501

\bibitem[Li and Oldenburg, 1998]{li_oldenburg}
Li Y, Oldenburg DW (1998)
3-D inversion of gravity data. Geophysics 63:109-119.
doi: 10.1190/1.1444302

\bibitem[Li and Oldenburg, 2003]{li_compression}
Li Y, Oldenburg DW (2003)
Fast inversion of large-scale magnetic data using wavelet transforms and a
logarithmic barrier method. Geophysical Journal International 152:251-265.
doi: 10.1046/j.1365-246X.2003.01766.x

\bibitem[Martins et~al., 2011]{martins_tv}
Martins CM, Lima WA, Barbosa VCF, Silva JBC (2011)
Total variation regularization for depth-to-basement estimate:
Part 1 - Mathematical details and applications. Geophysics 76:I1-I12.
doi: 10.1190/1.3524286

\bibitem[Ramachandran and Varoquaux, 2011]{mayavi}
Ramachandran P, Varoquaux G (2011)
Mayavi: 3D Visualization of Scientific Data. Computing in Science \& Engineering
13:40-51. doi: 10.1109/MCSE.2011.35

\bibitem[Ren\'e, 1986]{rene}
Ren\'e RM (1986)
Gravity inversion using open, reject, and ``shape-of-anomaly'' fill criteria.
Geophysics 51:988-994. doi: 10.1190/1.1442157

\bibitem[Silva et~al., 2001]{silva_potinversion}
Silva JBC, Medeiros WE, Barbosa VCF (2001)
Potential-field inversion: Choosing the appropriate technique to solve a
geologic problem. Geophysics 66:511-520. doi: 10.1190/1.1444941

\bibitem[Silva and Barbosa, 2006]{silva_interactive}
Silva JBC, Barbosa VCF (2006)
Interactive gravity inversion. Geophysics 71:J1-J9. doi: 10.1190/1.2168010

\bibitem[Silva Dias et~al., 2009]{silvadias_adaptive}
Silva Dias FJS, Barbosa VCF, Silva JBC (2009)
3D gravity inversion through an adaptive-learning procedure.
Geophysics 74:I9-I21. doi: 10.1190/1.3092775

\bibitem[Portniaguine and Zhdanov, 2002]{zhdanov_compression}
Portniaguine O, Zhdanov MS (2002)
3‐D magnetic inversion with data compression and image focusing.
Geophysics 67:1532-1541. doi: 10.1190/1.1512749

\bibitem[Portniaguine and Zhdanov, 1999]{zhdanov_focusing}
Portniaguine O, Zhdanov MS (1999)
Focusing geophysical inversion images. Geophysics 64:874-887.
doi: 10.1190/1.1444596

\bibitem[Uieda and Barbosa, 2012a]{uieda_animation}
Uieda L, Barbosa VCF (2012a)
Animation of growth iterations during 3D gravity gradient inversion by planting
anomalous densities. Figshare. http://dx.doi.org/10.6084/m9.figshare.91469.
Accessed 06 December 2012.

\bibitem[Uieda and Barbosa, 2012b]{uieda_planting}
Uieda L, Barbosa VCF (2012b)
Robust 3D gravity gradient inversion by planting anomalous densities.
Geophysics 77:G55-G66. doi: 10.1190/geo2011-0388.1

\bibitem[Uieda and Barbosa, 2012c]{uieda_shape}
Uieda L, Barbosa VCF (2012c)
Use of the ``shape-of-anomaly'' data misfit in 3D inversion by planting
anomalous densities. SEG Technical Program Expanded Abstracts 2012.
doi: 10.1190/segam2012-0383.1

\end{thebibliography}

\end{document}

